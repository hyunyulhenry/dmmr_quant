<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>SQL 기초</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


</head>

<body class="fullcontent">

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">SQL 기초</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>만일 수많은 데이터를 텍스트나 엑셀 파일로 관리할 경우 어떠한 단점이 있을까? 먼저 다수의 사람이 데이터를 공유하기 어려우며, 원하는 데이터가 있으면 매번 파일을 전송해주어야 하는 번거로움이 있다. 둘째로는 대량의 데이터를 다루기가 힘들다. 마지막으로 파일 삭제, 하드 디스크 고장, 보안 문제 등 사고에 대응하기가 어렵다. 이러한 이유로 실무에서는 대부분 데이터베이스를 이용해 데이터를 효율적으로 관리한다.</p>
<p>데이터베이스(database, DB)란 여러 사람이 공유하여 사용할 목적으로 체계화하여 통합, 관리하는 데이터의 집합이다. 예를 들어 티커, 주가, 재무제표, 목표주가 등 투자와 관련된 모든 데이터를 데이터베이스에 저장한 후 이를 관리하거나 사용할 수 있다. 데이터베이스 관리 시스템(database management system, DBMS)이란 다수의 사용자들이 데이터베이스 내의 데이터를 접근할 수 있도록 해주는 소프트웨어 도구의 집합이다. DBMS는 대량의 데이터를 다수의 사람이 안전하고 간단히 다룰 수 있게 해주는 장점이 있다.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-160225679.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="images/image-160225679.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p>DBMS 중 가장 일반적으로 사용되는 것이 관계형 데이터베이스(Relational Database)다. 이는 엑셀 시트처럼 열과 행으로 이루어진 2차원 표 형식으로써 데이터를 관리하거나 이해하기 쉽다. 또한 SQL이라는 전용 언어를 사용해서 데이터를 처리할 수 있다. 이러한 관계형 데이터베이스 관리 시스템 중 대표적으로 사용되는 것으로는 오라클 RDBMS, MS SQL Server, Postgre SQL, MySQL 등이 있으며 본 강의에서는 무료로 사용 가능한 MySQL을 살펴보도록 하겠다.</p>
<section id="데이터베이스의-구성-요소" class="level2">
<h2 class="anchored" data-anchor-id="데이터베이스의-구성-요소">데이터베이스의 구성 요소</h2>
<p>데이터베이스는 각각의 테이블로 이루어져 있으며, 테이블의 구성요소는 크게 다음과 같다.</p>
<ul>
<li>열(컬럼): 테이블에 보관하는 데이터 항목이다.</li>
<li>행(레코드): 데이터 한 건에 해당하며, RDBMS는 반드시 행 단위로 데이터를 읽고 쓴다.</li>
<li>셀(값): 행과 열이 교차하는 하나의 값이며, 하나의 셀 안에는 하나의 데이터만 넣을 수 있다.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-1545246059.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="images/image-1545246059.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</section>
<section id="데이터베이스와-테이블-만들기" class="level2">
<h2 class="anchored" data-anchor-id="데이터베이스와-테이블-만들기">데이터베이스와 테이블 만들기</h2>
<p>먼저 각각의 테이블이 저장될 데이터베이스(스키마)를 만들어 보도록 하자. MySQL Workbench를 열어 아래의 쿼리를 입력한다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>create database shop;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-829499337.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="images/image-829499337.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p><code>create database [데이터베이스명]</code>은 데이터베이스를 만드는 SQL 쿼리다. 쿼리를 실행하는 방법은 원하는 부분을 선택한 후 Ctrl + Shift + Enter(맥 사용자의 경우 Modifier + Shift + Return) 키를 누른다. SQL 쿼리문의 끝에는 세미콜론(;)을 붙이며, 대문자나 소문자는 구분하지 않는다. 단 테이블에 등록된 데이터는 대/소문자가 구분된다.</p>
<p>쿼리가 실행되면 하단의 [Action Output] 부분에 <strong>create database shop</strong> 이라는 문구가 뜨며, shop이라는 데이터베이스가 만들어졌음을 알 수 있다. 이를 확인할 수 있는 방법은 아래 그림과 같이 [Navigator]부분 하단에서 [Schemas]를 선택한 후 우측 상단의 새로고침 마크를 클릭하면 shop 데이터베이스가 생겼음이 확인된다.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-1714098965.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="images/image-1714098965.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p>데이터베이스를 만들고 난 후에는 사용하고자 하는 데이터베이스를 지정해야하며, 이는 MySQL을 새로 열때마다 실행해야 한다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>use shop;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>use [데이터베이스명];</code> 쿼리를 통해 shop 데이터베이스를 사용할 것을 지정하였다.</p>
<p>이제 데이터베이스 하부에 테이블을 만들어보도록 하자. 테이블을 만드는 쿼리 형식은 다음과 같다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>create table <span class="sc">&lt;</span>테이블명<span class="sc">&gt;</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&lt;</span>열 이름 <span class="dv">1</span><span class="sc">&gt;</span> <span class="er">&lt;</span>데이터 형태<span class="sc">&gt;</span> <span class="er">&lt;</span>이 열의 제약<span class="sc">&gt;</span>,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="sc">&lt;</span>열 이름 <span class="dv">2</span><span class="sc">&gt;</span> <span class="er">&lt;</span>데이터 형태<span class="sc">&gt;</span> <span class="er">&lt;</span>이 열의 제약<span class="sc">&gt;</span>,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="sc">&lt;</span>열 이름 <span class="dv">3</span><span class="sc">&gt;</span> <span class="er">&lt;</span>데이터 형태<span class="sc">&gt;</span> <span class="er">&lt;</span>이 열의 제약<span class="sc">&gt;</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>….</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="sc">&lt;</span>테이블의 제약 <span class="dv">1</span><span class="sc">&gt;</span>, <span class="sc">&lt;</span>테이블의 제약 <span class="dv">2</span><span class="sc">&gt;</span>, …. </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>위 형식에 맞춰 goods 테이블을 만들어주도록 한다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>create table goods</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>goods_id <span class="fu">char</span>(<span class="dv">4</span>) not null,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>goods_name <span class="fu">varchar</span>(<span class="dv">100</span>) not null,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>goods_classify <span class="fu">varchar</span>(<span class="dv">32</span>) not null,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>sell_price integer,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>buy_price integer,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>register_date date,</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>primary <span class="fu">key</span> (goods_id)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>모든 열에 integer나 char 등의 데이터 형식을 지정해 주어야 한다. MySQL에서 사용할 수 있는 데이터 타입의 종류는 크게 CHAR, BINARY, TEXT, VARCHAR, BLOB, 숫자형 데이터 타입이 있으며, 입력되는 데이터에 맞는 타입을 설정한다. 또한 각종 제약을 설정해줄 수 있다. null이란 데이터가 없음을 의미하며, not null은 반드시 데이터가 존재해야 한다는 의미이다. 마지막으로 goods_id 열을 기본 키(primary key)로 지정해준다.</p>
<p>위 쿼리를 실행한 후 좌측의 SCHEMAS 부분에서 새로고침을 해보면, shop 데이터베이스의 Tables에 [goods]가 생성되며, Columns 부분에서 우리가 입력한 열들을 확인할 수 있다. 또한 열 이름을 클릭하면 하단의 Information 부분에서 해당 열의 데이터 타입 또한 확인할 수 있다.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-1425715462.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img src="images/image-1425715462.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>데이터베이스나 테이블, 열 이름으로 사용할 수 있는 문자는 다음과 같다.</p>
<ul>
<li>영문자(간혹 한글이 되기는 하나 추천하지 않음)</li>
<li>숫자</li>
<li>언더바(_)</li>
</ul>
</div>
</div>
<section id="테이블-정의-변경하기" class="level3">
<h3 class="anchored" data-anchor-id="테이블-정의-변경하기">테이블 정의 변경하기</h3>
<p>테이블에 열을 추가로 만들거나 삭제를 해야하는 등 테이블의 정의를 변경해야 하는 경우 <code>ALTER TABLE</code> 문을 사용하면 된다. 먼저 열을 추가하는 쿼리는 다음과 같다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>alter table <span class="sc">&lt;</span>테이블명<span class="sc">&gt;</span> add column <span class="sc">&lt;</span>열 이름<span class="sc">&gt;</span> <span class="er">&lt;</span>열 정의<span class="sc">&gt;</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>shop 테이블에 goods_name이라는 열을 추가하며, 데이터 타입은 varchar(100)으로 설정하는 쿼리는 다음과 같다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>alter table goods add column goods_name_eng <span class="fu">varchar</span>(<span class="dv">100</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>쿼리를 실행하고 SCHEMAS 부분에서 새로고침을 누르면 shop 데이터베이스 내 goods 테이블에 goods_name_eng 열이 추가된 것이 확인된다.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-537243429.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6"><img src="images/image-537243429.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p>반대로 열을 삭제하는 쿼리는 다음과 같다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>alter table <span class="sc">&lt;</span>테이블명<span class="sc">&gt;</span> drop column <span class="sc">&lt;</span>열명<span class="sc">&gt;</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>이를 이용해 위에서 만든 goods_name_eng 열을 삭제하도록 한다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>alter table goods drop column goods_name_eng;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>쿼리 실행후 SCHEMAS 부분에서 새로고침을 누르면 goods 테이블에서 해당 열이 삭제된 것을 확인할 수 있다.</p>
</section>
<section id="테이블에-데이터-등록하기" class="level3">
<h3 class="anchored" data-anchor-id="테이블에-데이터-등록하기">테이블에 데이터 등록하기</h3>
<p>현재 goods 테이블은 아무런 데이터가 없는 빈 테이블 상태이므로, 데이터를 등록해주어야 한다. SQL에서 데이터를 등록하는 쿼리는 다음과 같다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>insert into <span class="sc">&lt;</span>테이블명<span class="sc">&gt;</span> <span class="fu">values</span> (값);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>아래 쿼리를 입력하여 goods 테이블에 데이터를 등록해주도록 한다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>insert into goods <span class="fu">values</span> (<span class="st">'0001'</span>, <span class="st">'티셔츠'</span>, <span class="st">'의류'</span>, <span class="dv">1000</span>, <span class="dv">500</span>, <span class="st">'2020-09-20'</span>);</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>insert into goods <span class="fu">values</span> (<span class="st">'0002'</span>, <span class="st">'펀칭기'</span>, <span class="st">'사무용품'</span>, <span class="dv">500</span>, <span class="dv">320</span>, <span class="st">'2020-09-11'</span>);</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>insert into goods <span class="fu">values</span> (<span class="st">'0003'</span>, <span class="st">'와이셔츠'</span>, <span class="st">'의류'</span>, <span class="dv">4000</span>, <span class="dv">2800</span>, <span class="cn">NULL</span>);</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>insert into goods <span class="fu">values</span> (<span class="st">'0004'</span>, <span class="st">'식칼'</span>, <span class="st">'주방용품'</span>, <span class="dv">3000</span>, <span class="dv">2800</span>, <span class="st">'2020-09-20'</span>);</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>insert into goods <span class="fu">values</span> (<span class="st">'0005'</span>, <span class="st">'압력솥'</span>, <span class="st">'주방용품'</span>, <span class="dv">6800</span>, <span class="dv">5000</span>, <span class="st">'2020-01-15'</span>);</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>insert into goods <span class="fu">values</span> (<span class="st">'0006'</span>, <span class="st">'포크'</span>, <span class="st">'주방용품'</span>, <span class="dv">500</span>, <span class="cn">NULL</span>, <span class="st">'2020-09-20'</span>);</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>insert into goods <span class="fu">values</span> (<span class="st">'0007'</span>, <span class="st">'도마'</span>, <span class="st">'주방용품'</span>, <span class="dv">880</span>, <span class="dv">790</span>, <span class="st">'2020-04-28'</span>);</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>insert into goods <span class="fu">values</span> (<span class="st">'0008'</span>, <span class="st">'볼펜'</span>, <span class="st">'사무용품'</span>, <span class="dv">100</span>, <span class="cn">NULL</span>, <span class="st">'2020-11-11'</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-299794122.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7"><img src="images/image-299794122.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p>쿼리가 제대로 실행되었으면 하단의 Output 부분이 위 그림과 같이 나타난다. 이 부분에서 SQL 초보자들에게 발생하는 대부분의 오류는 다음과 같다.</p>
<ul>
<li>한 번 입력한 데이터를 다시 입력(Error Code: 1062. Duplicate entry ‘000x’ for key ‘goods.PRIMARY’ 오류 메세지 발생)</li>
<li>테이블 내 열의 갯수와 입력하는 데이터의 열 갯수가 같지 않음(Error Code: 1136. Column count doesn’t match value count at row 1 오류 메세지 발생)</li>
</ul>
<p>이 외에도 발생하는 오류들은 하단의 Output 부분에 그 원인이 있으므로, 당황하지 말고 해당 메세지를 살펴보고 수정하면 된다.</p>
</section>
</section>
<section id="sql-기초구문-익히기" class="level2">
<h2 class="anchored" data-anchor-id="sql-기초구문-익히기">SQL 기초구문 익히기</h2>
<p>위에서 만든 테이블을 바탕으로 SQL에서 자주 사용되는 기초 구문들을 실습해보겠다.</p>
<section id="select-열-선택하기" class="level3">
<h3 class="anchored" data-anchor-id="select-열-선택하기">select: 열 선택하기</h3>
<p>테이블에서 원하는 열을 선택할 때는 <code>select</code> 문을 사용하며, 쿼리는 다음과 같다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>select <span class="sc">&lt;</span>열 이름 <span class="dv">1</span><span class="sc">&gt;</span> , <span class="sc">&lt;</span>열 이름 <span class="dv">2</span><span class="sc">&gt;</span>, … <span class="sc">&lt;</span>열 이름 n<span class="sc">&gt;</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>from <span class="sc">&lt;</span>테이블명<span class="sc">&gt;</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>goods 테이블 중 goods_id, goods_name, buy_price 열만 선택해보도록 하자.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>select goods_id, goods_name, buy_price</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>from goods;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-2049632662.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8"><img src="images/image-2049632662.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p>쿼리를 실행하면 하단의 [Result Grid]에 결과가 표시되며, 우리가 선택한 열만 표시된다. 만일 모든 데이터를 한번에 보고 싶다면 <code>select * from &lt;테이블명&gt;;</code> 형태로 입력하면 된다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>select <span class="sc">*</span> from goods;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-100985819.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9"><img src="images/image-100985819.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p><code>as</code> 키워드를 사용하면 열에 별명을 부여할 수도 있다. 만일 저장된 테이블의 열 이름이 길 경우 이를 모두 출력하면 직관적으로 내용을 이해하기 힘드므로 이름을 간결하게 변경하는 것이 나을 때도 있다. as 키워드를 사용하는 방법은 다음과 같다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>select <span class="sc">&lt;</span>열 이름 <span class="dv">1</span><span class="sc">&gt;</span> as <span class="sc">&lt;</span>별명<span class="sc">&gt;</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>from <span class="sc">&lt;</span>테이블명<span class="sc">&gt;</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>이를 이용해 goods_id, goods_name, buy_price의 이름을 바꾼 후 출력해보도록 하자.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>select goods_id as id,</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    goods_name as name,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    buy_price as price</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>from goods;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-1189510773.png" class="lightbox" data-gallery="quarto-lightbox-gallery-10"><img src="images/image-1189510773.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p>select 구를 통해 단순히 현재 있는 열을 선택할 뿐만 아니라 상수 및 계산식도 작성이 가능하다. 아래 쿼리를 실행해보도록 하자.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>select <span class="st">'상품'</span> as category,</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    <span class="dv">38</span> as num,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'2022-01-01'</span> as date,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    goods_id,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    goods_name,</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    sell_price, buy_price, sell_price <span class="sc">-</span> buy_price as profit</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>from goods;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-877961961.png" class="lightbox" data-gallery="quarto-lightbox-gallery-11"><img src="images/image-877961961.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p>category, num, date 열에는 각각 상품, 38, 2022-01-01이라는 상수가 입력된다. 또한 <code>sell_price - buy_price</code>를 통해 두 열의 차이를 계산할 수 있으며, as 키워드를 통해 해당 열을 profit 으로 출력한다. 만일 별명을 부여하지 않을 경우 해당 열 이름은 계산식인 [sell_price - buy_price]가 그대로 출력된다.</p>
</section>
<section id="distinct-중복-제거하기" class="level3">
<h3 class="anchored" data-anchor-id="distinct-중복-제거하기">distinct: 중복 제거하기</h3>
<p>중복된 데이터가 있는 경우 중복되는 값을 제거하고 고유한 값만 확인하고 싶을 때는 distinct 키워드를 사용하며, 사용법은 다음과 같다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>select distinct <span class="sc">&lt;</span>열 이름<span class="sc">&gt;</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>from <span class="sc">&lt;</span>테이블명<span class="sc">&gt;</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>상품 분류에 해당하는 goods_classify 열에는 중복된 값들이 존재한다. 만일 상품 분류가 어떤 것이 있는지 고유한 값만을 확인하고 싶을 경우 아래 쿼리를 실행하면 된다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>select distinct goods_classify</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>from goods;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-796677819.png" class="lightbox" data-gallery="quarto-lightbox-gallery-12"><img src="images/image-796677819.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p>상품 분류 중 고유한 값인 의류, 사무용품, 주방용품만이 출력된다.</p>
</section>
<section id="where-원하는-행-선택하기" class="level3">
<h3 class="anchored" data-anchor-id="where-원하는-행-선택하기">where: 원하는 행 선택하기</h3>
<p>여러 데이터 중 조건에 부합하는 행만 선택할 때는 where 구를 사용하면 된다. 이는 엑셀에서 필터 기능과도 비슷하다. where 구는 from 구 바로 뒤에 사용해야 작동한다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>select <span class="sc">&lt;</span>열 이름<span class="sc">&gt;</span>, …</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>from <span class="sc">&lt;</span>테이블명<span class="sc">&gt;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>where <span class="sc">&lt;</span>조건식<span class="sc">&gt;</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>테이블에서 상품 분류(goods_classify)가 의류인 데이터만 선택해보도록 하자.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>select goods_name, goods_classify</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>from goods</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>where goods_classify <span class="ot">=</span> <span class="st">'의류'</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-370385946.png" class="lightbox" data-gallery="quarto-lightbox-gallery-13"><img src="images/image-370385946.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p>여러 데이터 중 goods_classify가 의류인 데이터 2개(티셔츠, 와이셔츠)만 선택되었다.</p>
</section>
</section>
<section id="연산자" class="level2">
<h2 class="anchored" data-anchor-id="연산자">연산자</h2>
<p>연산자는 SQL 문에서 연산을 수행하기 위해 사용되는 사전에 예약된 단어 또는 문자로써 일반적으로 where 구 안에서 사용된다. 흔히 사용되는 연산자는 다음과 같다.</p>
<ul>
<li>산술 연산자</li>
<li>비교 연산자</li>
<li>논리 연산자</li>
</ul>
<section id="산술-연산자" class="level3">
<h3 class="anchored" data-anchor-id="산술-연산자">산술 연산자</h3>
<p>산술 연산자는 더하기, 빼기, 곱하기, 나누기 등 계산을 할 때 사용되는 연산자이다. 만일 판매가에서 구매가를 뺀 이익이 500 이상인 데이터만 선택하려면 다음과 같은 쿼리를 실행한다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>select <span class="sc">*</span>, sell_price <span class="sc">-</span> buy_price as profit</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>from goods</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>where sell_price <span class="sc">-</span> buy_price <span class="sc">&gt;=</span> <span class="dv">500</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-1343369426.png" class="lightbox" data-gallery="quarto-lightbox-gallery-14"><img src="images/image-1343369426.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p>where 구문 내애 [sell_price - buy_price]를 계산하여 이익이 500 이상인 조건에 만족하는 데이터만을 선택하였다.</p>
</section>
<section id="비교-연산자" class="level3">
<h3 class="anchored" data-anchor-id="비교-연산자">비교 연산자</h3>
<p>비교 연산자는 데이터의 크기를 비교할 때 사용되는 연산자이며, 종류는 다음과 같다.</p>
<table class="table">
<thead>
<tr class="header">
<th>연산자</th>
<th>의미</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>=</td>
<td>~와 같다</td>
</tr>
<tr class="even">
<td>&lt;&gt;</td>
<td>~와 같지 않다</td>
</tr>
<tr class="odd">
<td>&gt;=</td>
<td>~ 이상</td>
</tr>
<tr class="even">
<td>&gt;</td>
<td>~ 보다 크다</td>
</tr>
<tr class="odd">
<td>&lt;=</td>
<td>~ 이하</td>
</tr>
<tr class="even">
<td>&lt;</td>
<td>~ 보다 작다</td>
</tr>
</tbody>
</table>
<p>sell_price가 1000 이상인 데이터만 선택하는 쿼리는 다음과 같다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>select goods_name, goods_classify, sell_price</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>from goods</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>where sell_price <span class="sc">&gt;=</span> <span class="dv">1000</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-610821572.png" class="lightbox" data-gallery="quarto-lightbox-gallery-15"><img src="images/image-610821572.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p>숫자 뿐 아니라 날짜에도 비교 연산자를 사용할 수 있다. 등록일(register_date)이 2020년 9월 27일 이전인 데이터만 선택하는 쿼리는 다음과 같다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>select goods_name, goods_classify, register_date</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>from goods</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>where register_date <span class="sc">&lt;</span> <span class="st">'2020-09-27'</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-360089537.png" class="lightbox" data-gallery="quarto-lightbox-gallery-16"><img src="images/image-360089537.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</section>
<section id="논리-연산자" class="level3">
<h3 class="anchored" data-anchor-id="논리-연산자">논리 연산자</h3>
<p>where 구 내에 <code>and</code> 연산자와 <code>or</code> 연산자와 같은 논리 연산자를 사용하면 복수의 검색 조건을 조합할 수 있다. 예를 들어 상품 분류가 주방용품이고 판매가가 3000 이상인 데이터를 조회하는 쿼리는 다음과 같다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>select goods_name, goods_classify, sell_price</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>from goods</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>where goods_classify <span class="ot">=</span> <span class="st">'주방용품'</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>and sell_price <span class="sc">&gt;=</span> <span class="dv">3000</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-1784066997.png" class="lightbox" data-gallery="quarto-lightbox-gallery-17"><img src="images/image-1784066997.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p>두 조건을 모두 만족하는 데이터가 선택되었다. 만약 상품 분류가 주방용품이거나 판매가가 3000 이상인 경우처럼 여러 조건 중 하나만 만족해도 되는 경우를 검색하고 싶을 경우에는 <code>or</code> 연산자를 사용하면 된다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>select goods_name, goods_classify, sell_price</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>from goods</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>where goods_classify <span class="ot">=</span> <span class="st">'주방용품'</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>or sell_price <span class="sc">&gt;=</span> <span class="dv">3000</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-357868500.png" class="lightbox" data-gallery="quarto-lightbox-gallery-18"><img src="images/image-357868500.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</section>
</section>
<section id="집약-함수" class="level2">
<h2 class="anchored" data-anchor-id="집약-함수">집약 함수</h2>
<p>집약 함수란 여러 개의 레코드를 하나로 집약시키는 기능으로써, 대표적으로 사용되는 집약 함수는 다음과 같다.</p>
<table class="table">
<thead>
<tr class="header">
<th>함수명</th>
<th>의미</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>count</td>
<td>행 숫자를 계산</td>
</tr>
<tr class="even">
<td>sum</td>
<td>합계를 계산</td>
</tr>
<tr class="odd">
<td>avg</td>
<td>평균을 구함</td>
</tr>
<tr class="even">
<td>max</td>
<td>최댓값을 구함</td>
</tr>
<tr class="odd">
<td>min</td>
<td>최솟값을 구함</td>
</tr>
</tbody>
</table>
<section id="count-행-숫자를-계산" class="level3">
<h3 class="anchored" data-anchor-id="count-행-숫자를-계산"><code>count</code>: 행 숫자를 계산</h3>
<p><code>count</code> 함수는 행의 숫자를 계산한다. goods 테이블에 몇 개의 행이 있는 확인하는 쿼리는 다음과 같다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>select <span class="fu">count</span>(<span class="sc">*</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>from goods;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-2121736961.png" class="lightbox" data-gallery="quarto-lightbox-gallery-19"><img src="images/image-2121736961.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p>별표(*)는 모든 열을 의미하며 총 8개의 행이 있다는 것이 확인되었다. 그러나 이는 null이 포함된 행의 수이다. 만일 null을 제외한 행의 수를 계산하고자 할 때는 인수에 특정 열을 지정한다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>select <span class="fu">count</span>(buy_price)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>from goods;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-414843879.png" class="lightbox" data-gallery="quarto-lightbox-gallery-20"><img src="images/image-414843879.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p>‘buy_price’ 열의 8개 데이터 중에는 총 2개의 null값이 있다. 따라서 count 함수를 실행하면 null을 제외한 6개의 행이 있음이 확인된다. 즉 count(*)는 null을 포함한 행의 갯수를, count(열 이름)은 null을 제외한 행 수를 계산한다.</p>
</section>
<section id="sum-합계를-계산" class="level3">
<h3 class="anchored" data-anchor-id="sum-합계를-계산"><code>sum</code>: 합계를 계산</h3>
<p><code>sum</code> 함수는 특정 열의 합계를 계산하며, null 값은 무시하고 계산이 된다. sell_price와 buy_price 열의 합계를 구하는 쿼리는 다음과 같다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>select <span class="fu">sum</span>(sell_price), <span class="fu">sum</span>(buy_price)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>from goods;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-404015357.png" class="lightbox" data-gallery="quarto-lightbox-gallery-21"><img src="images/image-404015357.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</section>
<section id="avg-산술평균을-계산" class="level3">
<h3 class="anchored" data-anchor-id="avg-산술평균을-계산"><code>avg</code>: 산술평균을 계산</h3>
<p><code>avg</code> 함수는 산술평균을 구하며, 사용법은 <code>sum</code>과 동일하다. sell_price 열의 평균을 구하는 쿼리는 다음과 같다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>select <span class="fu">avg</span>(sell_price)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>from goods;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-894512491.png" class="lightbox" data-gallery="quarto-lightbox-gallery-22"><img src="images/image-894512491.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</section>
<section id="중복값-제외-후-집약함수-사용하기" class="level3">
<h3 class="anchored" data-anchor-id="중복값-제외-후-집약함수-사용하기">중복값 제외 후 집약함수 사용하기</h3>
<p>만일 상품 분류가 몇 개가 있는지 확인하고 싶을 때는 어떻게 하면 될까? <code>count</code> 함수의 인자에 <code>distict</code> 키워드를 사용해 중복되지 않은 데이터의 갯수를 계산할 수 있다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>select <span class="fu">count</span>(distinct goods_classify) </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>from goods;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-2002150835.png" class="lightbox" data-gallery="quarto-lightbox-gallery-23"><img src="images/image-2002150835.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p>goods_classify 에는 의류, 사무용품, 주방용품 3개가 있으므로 이에 해당하는 값이 계산되었다. 이는 count 뿐만 아니라 <code>sum(distinct 열 이름)</code>과 같이 다른 집약함수에도 동일하게 적용이 가능하다.</p>
</section>
</section>
<section id="그룹화와-정렬" class="level2">
<h2 class="anchored" data-anchor-id="그룹화와-정렬">그룹화와 정렬</h2>
<p>데이터를 특정 기준으로 그룹을 나누어 값을 계산해야 하는 경우가 많다. 예를 들어 상품 분류 별 혹은 등록일 별 그룹을 나누어 손익을 계산한다고 생각해 보자. 이러한 경우 SQL에서는 <code>group by</code> 구를 사용하여 데이터를 그룹화할 수 있다. 또한 검색 결과를 특정 기준으로 정렬할 필요가 있을 경우 <code>order by</code> 구를 사용하면 된다.</p>
<section id="그룹-나누기" class="level3">
<h3 class="anchored" data-anchor-id="그룹-나누기">그룹 나누기</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-407258548.png" class="lightbox" data-gallery="quarto-lightbox-gallery-24"><img src="images/image-407258548.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p>위 그림의 경우 category 별로 그룹을 나누어 평균을 계산하기 위해서는 데이터를 Blue, Green, Red 별로 그룹을 나누어 평균을 계산해야 한다. 이러한 그룹화 작업을 수행하는 구가 <code>group by</code>이며, 사용법은 아래와 같이 그룹을 나누고자 하는 열을 입력하면 된다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>select <span class="sc">&lt;</span>열 이름 <span class="dv">1</span><span class="sc">&gt;</span>, <span class="sc">&lt;</span>열 이름 <span class="dv">2</span><span class="sc">&gt;</span>, …..</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>from <span class="sc">&lt;</span>테이블명<span class="sc">&gt;</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>group by <span class="sc">&lt;</span>열 이름 <span class="dv">1</span><span class="sc">&gt;</span>, <span class="sc">&lt;</span>열 이름 <span class="dv">2</span><span class="sc">&gt;</span>, ….</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>상품 분류 별 데이터의 수를 계산하기 위한 쿼리는 다음과 같다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>select goods_classify, <span class="fu">count</span>(<span class="sc">*</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>from goods</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>group by goods_classify;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-1486710382.png" class="lightbox" data-gallery="quarto-lightbox-gallery-25"><img src="images/image-1486710382.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p>goods_classify 별로 그룹을 나눈 후 <code>count(*)</code>를 통해 각 그룹 별 행 갯수를 구할 수 있다. <code>group by</code> 구는 반드시 <code>from</code> 구 뒤에 두어야 한다. 이번에는 buy_price 별 행 갯수를 구해보도록 하자.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>select buy_price, <span class="fu">count</span>(<span class="sc">*</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>from goods</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>group by buy_price;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-1002240758.png" class="lightbox" data-gallery="quarto-lightbox-gallery-26"><img src="images/image-1002240758.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p>buy_price 열에는 null 데이터도 포함되어 있으며, 이 역시 별도의 그룹으로 분류됨을 알 수 있다. 만일 <code>where</code> 구를 통해 조건에 맞는 데이터를 선택한 후 <code>group by</code> 구를 통해 그룹을 나눌때는 어떻게 해야 할까? 이 경우 <code>where</code> 구 뒤에 <code>group by</code> 구를 작성해야 한다. 상품 분류가 의류인 것 중 buy_price 별 데이터의 수를 구하는 쿼리는 다음과 같다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>select buy_price, <span class="fu">count</span>(<span class="sc">*</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>from goods</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>where goods_classify <span class="ot">=</span> <span class="st">'의류'</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>group by buy_price;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>만일 <code>group by</code>를 통해 나온 결과에 조건을 지정하려면 어떻게 해야 할까? 이 경우 <code>where</code>이 아닌 <code>having</code> 구를 사용해야 한다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>select <span class="sc">&lt;</span>열 이름 <span class="dv">1</span><span class="sc">&gt;</span>, <span class="sc">&lt;</span>열 이름 <span class="dv">2</span><span class="sc">&gt;</span>, …</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>from <span class="sc">&lt;</span>테이블 명<span class="sc">&gt;</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>group by <span class="sc">&lt;</span>열 이름 <span class="dv">1</span><span class="sc">&gt;</span>, <span class="sc">&lt;</span>열 이름 <span class="dv">2</span><span class="sc">&gt;</span>, …</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>having <span class="sc">&lt;</span>그룹값에 대한 조건<span class="sc">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>예를 들어 상품 분류별로 판매가의 평균을 구한 후, 이 값이 2500 이상인 데이터를 구하는 쿼리는 다음과 같다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>select goods_classify, <span class="fu">avg</span>(sell_price)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>from goods</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>group by goods_classify</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>having <span class="fu">avg</span>(sell_price) <span class="sc">&gt;=</span> <span class="dv">2500</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-1770298132.png" class="lightbox" data-gallery="quarto-lightbox-gallery-27"><img src="images/image-1770298132.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p>요약하자면 <code>where</code>는 <code>group by</code> 계산 이전, <code>having</code>은 <code>group by</code> 계산 이후 적용된다.</p>
</section>
<section id="검색-결과-정렬하기" class="level3">
<h3 class="anchored" data-anchor-id="검색-결과-정렬하기">검색 결과 정렬하기</h3>
<p>SQL에서는 결과가 무작위로 정렬되므로 쿼리를 실행할 때 마다 결과가 변한다. 오름차순이나 내림차순으로 결과를 정렬하고자 할 경우에는 <code>order by</code> 구를 사용한다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>select <span class="sc">&lt;</span>열 이름 <span class="dv">1</span><span class="sc">&gt;</span>, <span class="sc">&lt;</span>열 이름 <span class="dv">2</span><span class="sc">&gt;</span>, …</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>from <span class="sc">&lt;</span>테이블명<span class="sc">&gt;</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>order by <span class="sc">&lt;</span>재정렬 기준 열 <span class="dv">1</span><span class="sc">&gt;</span>, <span class="sc">&lt;</span>재정렬 기준 열 <span class="dv">2</span><span class="sc">&gt;</span>, ...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>예를 들어 sell_price가 싼 순서, 즉 오름차순으로 정렬할 경우 쿼리는 다음과 같다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>select <span class="sc">*</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>from goods</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>order by sell_price;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-197021106.png" class="lightbox" data-gallery="quarto-lightbox-gallery-28"><img src="images/image-197021106.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p><code>order by</code> 구는 기본적으로 오름차순으로 데이터를 정렬한다. 만일 내림차순으로 정렬하고자 할 경우 재정렬 기준 뒤에 desc 키워드를 사용한다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>select <span class="sc">*</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>from goods</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>order by sell_price desc;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-2090275644.png" class="lightbox" data-gallery="quarto-lightbox-gallery-29"><img src="images/image-2090275644.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</section>
</section>
<section id="뷰와-서브쿼리" class="level2">
<h2 class="anchored" data-anchor-id="뷰와-서브쿼리">뷰와 서브쿼리</h2>
<p>기초구문 만으로는 복잡한 형태의 데이터분석을 하는게 한계가 있으며, 뷰와 서브쿼리를 이용하면 이러한 작업을 쉽게 할 수 있다.</p>
<section id="뷰-만들기" class="level3">
<h3 class="anchored" data-anchor-id="뷰-만들기">뷰 만들기</h3>
<p>뷰는 기본적으로 테이블과 거의 동일하다. 그러나 테이블과의 차이는 실제 데이터를 저장하고 있지 않다는 점이다. 뷰는 데이터를 저장하지 않고 있으며, 뷰에서 데이터를 꺼내려고 할 때 내부적으로 쿼리를 실행하여 일시적인 가상 테이블을 만든다. 즉, 데이터가 아닌 쿼리를 저장하고 있다고 보면 된다. 이러한 뷰가 가진 장점은 다음과 같다.</p>
<ol type="1">
<li><p>데이터를 저장하지 않기 때문에 기억 장치 용량을 절약할 수 있다.</p></li>
<li><p>자주 사용하는 쿼리를 매번 작성하지 않고 뷰로 저장하면 반복해서 사용이 가능한다. 뷰는 원래의 테이블과 연동되므로, 데이터가 최신 상태로 갱신되면 뷰의 결과 역시 자동으로 최신 상태를 보여준다.</p></li>
</ol>
<p>뷰는 <code>create view</code> 문을 사용해 만들 수 있다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>create view 뷰 이름 (<span class="sc">&lt;</span>뷰의 열 이름 <span class="dv">1</span><span class="sc">&gt;</span>, <span class="sc">&lt;</span>뷰의 열 이름 <span class="dv">2</span><span class="sc">&gt;</span>, ...)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>as</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&lt;</span>쿼리<span class="sc">&gt;</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>만일 <strong>상품 분류 별 행 갯수</strong>를 매일 조회해야 한다면, 매번 쿼리를 실행하는 것 보다 뷰를 만들어 이를 확인하는 것이 훨씬 효율적이다. 아래의 쿼리를 통해 해당 뷰를 만들 수 있다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>create view <span class="fu">GoodSum</span> (goods_classify, cnt_goods)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>as</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>select goods_classify, <span class="fu">count</span>(<span class="sc">*</span>)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>from goods</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>group by goods_classify;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-388937663.png" class="lightbox" data-gallery="quarto-lightbox-gallery-30"><img src="images/image-388937663.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p>위 쿼리를 실행한 후 SCHEMAS 부분에서 새로고침을 눌러보면 Views 하부에 goodsum 이라는 뷰가 생긴것이 확인된다. 뷰의 데이터를 확인하는 방법은 테이블의 데이터를 확인하는 방법과 동일하다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>select <span class="sc">*</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>from GoodSum;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-802932872.png" class="lightbox" data-gallery="quarto-lightbox-gallery-31"><img src="images/image-802932872.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</section>
<section id="뷰-삭제하기" class="level3">
<h3 class="anchored" data-anchor-id="뷰-삭제하기">뷰 삭제하기</h3>
<p>뷰를 삭제하려면 <code>drop view 뷰명</code> 문을 사용한다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>drop view GoodSum;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>혹은 SCHEMAS 영역에서 삭제하고자 하는 뷰를 선택한 후 마우스 우클릭을 눌러 [Drop View]를 클릭해도 해당 뷰가 삭제된다.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-698253090.png" class="lightbox" data-gallery="quarto-lightbox-gallery-32"><img src="images/image-698253090.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</section>
<section id="서브쿼리" class="level3">
<h3 class="anchored" data-anchor-id="서브쿼리">서브쿼리</h3>
<p>서브쿼리란 쿼리 내의 쿼리이며, 일회용 뷰를 의미한다. 즉, 뷰를 정의하는 구문을 그대로 다른 구 안에 삽입하는 것이다. 먼저 뷰를 만든 후 이를 확인하는 쿼리는 다음과 같다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>create view <span class="fu">GoodSum</span> (goods_classify, cnt_goods)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>as</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>select goods_classify, <span class="fu">count</span>(<span class="sc">*</span>)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>from goods</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>group by goods_classify;</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>select <span class="sc">*</span> from GoodSum;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>이와 동일한 결과가 나오게 하는 서브쿼리는 다음과 같다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>select goods_classify, cnt_goods</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">from</span> (</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a> select goods_classify, <span class="fu">count</span>(<span class="sc">*</span>) as cnt_goods</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a> from goods</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a> group by goods_classify</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>) as GoodsSum;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>from 구 뒤의 괄호안에 해당하는 부분은 뷰를 만들 때 사용하던 코드와 동일하다. 즉, ① from 구 안의 select 문(서브쿼리)가 실행되고, ② 이 결과를 바탕으로 바깥쪽 select 문이 실행된다.</p>
</section>
<section id="스칼라-서브쿼리" class="level3">
<h3 class="anchored" data-anchor-id="스칼라-서브쿼리">스칼라 서브쿼리</h3>
<p>스칼라 서브쿼리란 단이 값이 반환되는 서브쿼리다. 이를 통해 =, &lt;, &gt; 등 비교 연산자의 입력값으로 사용할 수 있다. 예를 들어 판매단가가 전체 평균 판매단가보다 높은 상품만을 검색하려면 어떻게 해야할까? 먼저 평균 단가를 계산해야 한다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>select <span class="fu">avg</span>(sell_price)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>from goods;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-993074810.png" class="lightbox" data-gallery="quarto-lightbox-gallery-33"><img src="images/image-993074810.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p>해당 쿼리를 서브쿼리에 넣어 원하는 값을 찾을 수 있다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>select <span class="sc">*</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>from goods</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>where sell_price <span class="sc">&gt;</span> (select <span class="fu">avg</span>(sell_price) from goods);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-751377788.png" class="lightbox" data-gallery="quarto-lightbox-gallery-34"><img src="images/image-751377788.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p>스칼라 서브쿼리는 where 구 뿐만 아니라 select, group by, having, order by 구 등 거의 모든 곳에 쓸 수 있다. 평균 판매가격을 새로운 열로 만드는 쿼리는 다음과 같다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>select goods_id, goods_name, sell_price,</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>    (select <span class="fu">avg</span>(sell_price) from goods) as avg_price</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>from goods;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-1479272606.png" class="lightbox" data-gallery="quarto-lightbox-gallery-35"><img src="images/image-1479272606.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p>select 구문 내에 <code>select avg(sell_price) from goods</code> 쿼리를 입력하여 평균 판매가격을 계산한 후 이를 avg_price 라는 열 이름으로 출력한다.</p>
<p>이번에는 좀 더 복잡한 조건에 해당하는 데이터를 찾아보도록 하자. 상품 분류 별 평균 판매가격이 전체 데이터의 평균 판매가격 이상인 데이터만 출력하는 쿼리는 다음과 같다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>select goods_classify, <span class="fu">avg</span>(sell_price)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>from goods</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>group by goods_classify</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>having <span class="fu">avg</span>(sell_price) <span class="sc">&gt;</span> (select <span class="fu">avg</span>(sell_price) from goods);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-910567044.png" class="lightbox" data-gallery="quarto-lightbox-gallery-36"><img src="images/image-910567044.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p>먼저 <code>group by</code> 구문을 이용해 상품 분류 별 평균 판매가격을 계산한다. 그 후 having 구문 내에 전체 평균 판매가격을 계산하는 서브쿼리인 <code>select avg(sell_price) from goods</code> 를 입력하여 2097.5 라는 값을 계산하고, 그룹별 평균 판매가격이 이 값보다 큰 데이터만을 선택하게 된다.</p>
</section>
</section>
<section id="함수-술어와-case-식" class="level2">
<h2 class="anchored" data-anchor-id="함수-술어와-case-식">함수, 술어와 case 식</h2>
<p>SQL에서도 함수를 이용해 다양한 연산을 할 수 있으며, 다음과 같은 함수가 존재한다. 본 책에서는 수치 계산을 위한 ‘산술 함수’, 문자열 처리를 위한 ‘문자열 함수’, 날짜 처리를 위한 ’날짜 함수’에 대해 대해 알아보겠다. 또한 함수의 변형 형태인 술어는 반환 값이 진리값(TRUE/FALSE/UNKNOWN)인 함수라 볼 수 있다. 마지막으로 <code>case</code> 식 역시 함수의 일종으로써, SQL 내에서의 if문 이라고도 볼 수 있다. <code>case</code>는 조건에 해당하는 목록을 평가하고 가능한 여러 결과 식 중 하나를 반환한다.</p>
<section id="산술-함수" class="level3">
<h3 class="anchored" data-anchor-id="산술-함수">산술 함수</h3>
<p>산술 함수는 숫자형 데이터의 절대값, 올림, 내림, 반올림 등을 계산할 수 있게 해준다. 먼저 m, n, p 3개 열로 구성된 테이블(SampleMath)을 만들어 주도록 한다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>create table SampleMath</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>(m  <span class="fu">numeric</span> (<span class="dv">10</span>,<span class="dv">3</span>),</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a> n  integer,</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a> p  integer);</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>insert into <span class="fu">SampleMath</span>(m, n, p) <span class="fu">values</span> (<span class="dv">500</span>, <span class="dv">0</span>, <span class="cn">NULL</span>);</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>insert into <span class="fu">SampleMath</span>(m, n, p) <span class="fu">values</span> (<span class="sc">-</span><span class="dv">180</span>, <span class="dv">0</span>, <span class="cn">NULL</span>);</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>insert into <span class="fu">SampleMath</span>(m, n, p) <span class="fu">values</span> (<span class="cn">NULL</span>, <span class="cn">NULL</span>, <span class="cn">NULL</span>);</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>insert into <span class="fu">SampleMath</span>(m, n, p) <span class="fu">values</span> (<span class="cn">NULL</span>, <span class="dv">7</span>, <span class="dv">3</span>);</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>insert into <span class="fu">SampleMath</span>(m, n, p) <span class="fu">values</span> (<span class="cn">NULL</span>, <span class="dv">5</span>, <span class="dv">2</span>);</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>insert into <span class="fu">SampleMath</span>(m, n, p) <span class="fu">values</span> (<span class="cn">NULL</span>, <span class="dv">4</span>, <span class="cn">NULL</span>);</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>insert into <span class="fu">SampleMath</span>(m, n, p) <span class="fu">values</span> (<span class="dv">8</span>, <span class="cn">NULL</span>, <span class="dv">3</span>);</span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>insert into <span class="fu">SampleMath</span>(m, n, p) <span class="fu">values</span> (<span class="fl">2.27</span>, <span class="dv">1</span>, <span class="cn">NULL</span>);</span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>insert into <span class="fu">SampleMath</span>(m, n, p) <span class="fu">values</span> (<span class="fl">5.555</span>,<span class="dv">2</span>, <span class="cn">NULL</span>);</span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>insert into <span class="fu">SampleMath</span>(m, n, p) <span class="fu">values</span> (<span class="cn">NULL</span>, <span class="dv">1</span>, <span class="cn">NULL</span>);</span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>insert into <span class="fu">SampleMath</span>(m, n, p) <span class="fu">values</span> (<span class="fl">8.76</span>, <span class="cn">NULL</span>, <span class="cn">NULL</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-291790077.png" class="lightbox" data-gallery="quarto-lightbox-gallery-37"><img src="images/image-291790077.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<section id="abs-절대값-계산하기" class="level4">
<h4 class="anchored" data-anchor-id="abs-절대값-계산하기"><code>abs</code>: 절대값 계산하기</h4>
<p><code>abs</code> 함수는 해당 열에 있는 값들의 절대값을 구해준다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>select m, <span class="fu">abs</span>(m) as abs_m</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>from SampleMath;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-911742242.png" class="lightbox" data-gallery="quarto-lightbox-gallery-38"><img src="images/image-911742242.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p>abs_m은 m열의 절대값을 계산한 것이며, 두번째 행을 보면 -180의 절대값에 해당하는 180이 계산되었다.</p>
</section>
<section id="mod-나눗셈의-나머지-구하기" class="level4">
<h4 class="anchored" data-anchor-id="mod-나눗셈의-나머지-구하기"><code>mod</code>: 나눗셈의 나머지 구하기</h4>
<p>7 나누기 3의 몫은 2이며 나머지는 1이다. <code>mod</code> 함수는 이 나머지에 해당하는 값을 구해준다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>select n, p, <span class="fu">mod</span>(n, p) as mod_col</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>from SampleMath;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-814133807.png" class="lightbox" data-gallery="quarto-lightbox-gallery-39"><img src="images/image-814133807.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p><code>mod(n, p)</code>를 통해 n/p의 나머지를 구한다. 즉 7/3의 나머지인 1, 5/2의 나머지인 1이 계산되며, null은 계산이 불가한 데이터이므로 결과 역시 null로 나온다.</p>
</section>
</section>
<section id="round-반올림-하기" class="level3">
<h3 class="anchored" data-anchor-id="round-반올림-하기"><code>round</code>: 반올림 하기</h3>
<p><code>round</code> 함수를 통해 반올림을 할 수 있으며, 몇 째자리에서 반올림을 할지 정할 수 있다. <code>round(m, 2)</code>의 경우 할 경우 m열의 데이터를 소수 둘째자리까지 반올림한다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>select m, n, <span class="fu">round</span>(m, n) as round_col</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>from SampleMath;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-460561723.png" class="lightbox" data-gallery="quarto-lightbox-gallery-40"><img src="images/image-460561723.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p>위의 쿼리는 m 열을 n 자리까지 반올림한다. n이 0인 경우 소수 0번째 자리, 즉 정수부분까지 반올림을 한다. n이 1인 경우에는 소수 첫째자리까지 반올림을 하기 위해 소수 둘째자리에서 반올림을 한다. <code>round</code>와 비슷한 함수로 올림에는 <code>ceil</code>, 내림에는 <code>floor</code> 함수가 있으므로 상황에 맞게 사용하면 된다</p>
</section>
<section id="문자열-함수" class="level3">
<h3 class="anchored" data-anchor-id="문자열-함수">문자열 함수</h3>
<p>문자열 함수는 문자 데이터를 처리할 때 사용되는 함수들이다. 먼저 아래의 샘플 테이블(SampleStr)을 만들도록 하자.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>create table SampleStr</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>(str1  <span class="fu">varchar</span>(<span class="dv">40</span>),</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a> str2  <span class="fu">varchar</span>(<span class="dv">40</span>),</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a> str3  <span class="fu">varchar</span>(<span class="dv">40</span>));</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>insert into <span class="fu">SampleStr</span> (str1, str2, str3) <span class="fu">values</span> (<span class="st">'가나다'</span>, <span class="st">'라마'</span>, <span class="cn">NULL</span>);</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>insert into <span class="fu">SampleStr</span> (str1, str2, str3) <span class="fu">values</span> (<span class="st">'abc'</span>, <span class="st">'def'</span>, <span class="cn">NULL</span>);</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>insert into <span class="fu">SampleStr</span> (str1, str2, str3) <span class="fu">values</span> (<span class="st">'김'</span>, <span class="st">'철수'</span>, <span class="st">'입니다'</span>);</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>insert into <span class="fu">SampleStr</span> (str1, str2, str3) <span class="fu">values</span> (<span class="st">'aaa'</span>, <span class="cn">NULL</span>, <span class="cn">NULL</span>);</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>insert into <span class="fu">SampleStr</span> (str1, str2, str3) <span class="fu">values</span> (<span class="cn">NULL</span>, <span class="st">'가가가'</span>, <span class="cn">NULL</span>);</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>insert into <span class="fu">SampleStr</span> (str1, str2, str3) <span class="fu">values</span> (<span class="st">'@!#$%'</span>, <span class="cn">NULL</span>, <span class="cn">NULL</span>);</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>insert into <span class="fu">SampleStr</span> (str1, str2, str3) <span class="fu">values</span> (<span class="st">'ABC'</span>, <span class="cn">NULL</span>, <span class="cn">NULL</span>);</span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>insert into <span class="fu">SampleStr</span> (str1, str2, str3) <span class="fu">values</span> (<span class="st">'aBC'</span>, <span class="cn">NULL</span>, <span class="cn">NULL</span>);</span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>insert into <span class="fu">SampleStr</span> (str1, str2, str3) <span class="fu">values</span> (<span class="st">'abc철수'</span>, <span class="st">'abc'</span>, <span class="st">'ABC'</span>);</span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>insert into <span class="fu">SampleStr</span> (str1, str2, str3) <span class="fu">values</span> (<span class="st">'abcdefabc'</span>,<span class="st">'abc'</span>, <span class="st">'ABC'</span>);</span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>insert into <span class="fu">SampleStr</span> (str1, str2, str3) <span class="fu">values</span> (<span class="st">'아이우'</span>, <span class="st">'이'</span>,<span class="st">'우'</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-460415584.png" class="lightbox" data-gallery="quarto-lightbox-gallery-41"><img src="images/image-460415584.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<section id="concat-문자열-연결" class="level4">
<h4 class="anchored" data-anchor-id="concat-문자열-연결"><code>concat</code>: 문자열 연결</h4>
<p><code>concat</code> 함수는 여러 열의 문자열을 연결하는데 사용됩니다. (타 RDMS에서는 ||로 문자를 합치기도 한다.) 먼저 str1과 str2 열의 문자를 합쳐보도록 하자.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>select str1, str2, <span class="fu">concat</span>(str1, str2) as str_concat</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>from SampleStr;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-1487627696.png" class="lightbox" data-gallery="quarto-lightbox-gallery-42"><img src="images/image-1487627696.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p>두 열의 문자가 하나로 합쳐지며, null이 포함된 경우는 결과 역시 null이 반환된다.</p>
</section>
<section id="lower-소문자로-변환" class="level4">
<h4 class="anchored" data-anchor-id="lower-소문자로-변환"><code>lower</code>: 소문자로 변환</h4>
<p><code>lower</code> 함수는 모든 알파벳을 소문자로 변환한다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>select str1, <span class="fu">lower</span>(str1) as low_str</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>from SampleStr;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-1406493215.png" class="lightbox" data-gallery="quarto-lightbox-gallery-43"><img src="images/image-1406493215.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p>ABC가 abc로 변환되는 등 모든 알파벳이 소문자로 변환되었다. 반대로 모든 알파벳을 대문자로 변환하고자 할 경우 <code>upper</code> 함수를 사용하면 된다.</p>
</section>
<section id="replace-문자를-변경" class="level4">
<h4 class="anchored" data-anchor-id="replace-문자를-변경"><code>replace</code>: 문자를 변경</h4>
<p><code>replace</code> 함수는 문자열 안에 있는 일부 문자를 다른 문자열로 변경하며, <code>replace(대상 문자열, 치환 전 문자열, 치환 후 문자열)</code> 형태로 입력한다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>select str1, str2, str3,</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">replace</span>(str1, str2, str3) as rep_str</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>from SampleStr;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><a href="images/image-284393014.png" class="lightbox" data-gallery="quarto-lightbox-gallery-44"><img src="images/image-284393014.png" class="img-fluid"></a> str1열 중 str2열에 해당하는 문자가 있을 경우 str3열의 문자로 변경된다.</p>
</section>
</section>
<section id="날짜-함수" class="level3">
<h3 class="anchored" data-anchor-id="날짜-함수">날짜 함수</h3>
<p>SQL에는 날짜를 다루는 많은 함수가 있으며, DBMS 종류마다 그 형태가 약간씩 다르다.</p>
<section id="현재-날짜-시간-일시" class="level4">
<h4 class="anchored" data-anchor-id="현재-날짜-시간-일시">현재 날짜, 시간, 일시</h4>
<p>현재 날짜(<code>current_date</code>)와 시간(<code>current_time</code>), 일시(<code>current_timestamp</code>)를 다루는 함수의 경우 from 구문이 없이 사용이 가능하다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>select current_date, current_time, current_timestamp;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-1743170120.png" class="lightbox" data-gallery="quarto-lightbox-gallery-45"><img src="images/image-1743170120.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</section>
<section id="날짜-요소-추출하기" class="level4">
<h4 class="anchored" data-anchor-id="날짜-요소-추출하기">날짜 요소 추출하기</h4>
<p><code>extract(날짜 요소 from 날짜)</code> 함수를 통해 년, 월, 시, 초 등을 추출할 수 있다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>select</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>    current_timestamp,</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">extract</span>(year from current_timestamp) as year,</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">extract</span>(month from current_timestamp) as month,</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">extract</span>(day from current_timestamp) as day,</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">extract</span>(hour from current_timestamp) as hour,</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">extract</span>(minute from current_timestamp) as minute,</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">extract</span>(second from current_timestamp) as second;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-1978952196.png" class="lightbox" data-gallery="quarto-lightbox-gallery-46"><img src="images/image-1978952196.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</section>
</section>
<section id="술어" class="level3">
<h3 class="anchored" data-anchor-id="술어">술어</h3>
<p>술어란 반환 값이 진리값(TRUE, FALSE, UNKNOWN)인 함수를 가리킨다. 대표적인 예로는 <code>like</code>, <code>between</code>, <code>is null</code>, <code>in</code> 등이 있다.</p>
<section id="like-문자열-부분-일치" class="level4">
<h4 class="anchored" data-anchor-id="like-문자열-부분-일치"><code>like</code>: 문자열 부분 일치</h4>
<p>앞에서 문자열을 검색할 때는 등호(=)를 사용했지만, 이는 완전히 일치하는 경우에만 참이 된다. 반면 <code>like</code> 술어는 문자열 중 <strong>부분 일치를 검색</strong>할 때 사용한다. 먼저 아래의 테이블을 만들도록 한다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>create table SampleLike</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>(strcol <span class="fu">varchar</span>(<span class="dv">6</span>) not null,</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>primary <span class="fu">key</span> (strcol));</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>insert into <span class="fu">SampleLike</span> (strcol) <span class="fu">values</span> (<span class="st">'abcddd'</span>);</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>insert into <span class="fu">SampleLike</span> (strcol) <span class="fu">values</span> (<span class="st">'dddabc'</span>);</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>insert into <span class="fu">SampleLike</span> (strcol) <span class="fu">values</span> (<span class="st">'abdddc'</span>);</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>insert into <span class="fu">SampleLike</span> (strcol) <span class="fu">values</span> (<span class="st">'abcdd'</span>);</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>insert into <span class="fu">SampleLike</span> (strcol) <span class="fu">values</span> (<span class="st">'ddabc'</span>);</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>insert into <span class="fu">SampleLike</span> (strcol) <span class="fu">values</span> (<span class="st">'abddc'</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-99188783.png" class="lightbox" data-gallery="quarto-lightbox-gallery-47"><img src="images/image-99188783.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p>일치에는 크게 3가지 종류가 있다.</p>
<ul>
<li>전방 일치: 검색 조건이 되는 문자열이 검색 대상 문자열의 가장 앞에 위치하고 있는 레코드를 선택한다.</li>
<li>중간 일치: 검색 조건이 되는 문자열이 검색 대상 문자열의 어딘가에 포함되어 있으면 레코드를 검색하며 위치는 어디든 상관없다.</li>
<li>후방 일치: 검색 조건이 되는 문자열이 검색 대상 문자열의 가장 뒤에 위치하고 있는 레코드를 검색한다.</li>
</ul>
<p>먼저 전방 일치 검색은 다음과 같다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>select <span class="sc">*</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>from samplelike</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>where strcol like <span class="st">'ddd%'</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-454125525.png" class="lightbox" data-gallery="quarto-lightbox-gallery-48"><img src="images/image-454125525.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p><code>%</code>는 ‘0문자 이상의 임의 문자열’ 을 의미하는 특수 기호이며, 위의 예에서 ’ddd%’는 ’ddd로 시작하는 모든 문자열’을 의미한다.</p>
<p>다음으로 중간 일치 검색은 다음과 같다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>select <span class="sc">*</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>from SampleLike</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>where strcol like <span class="st">'%ddd%'</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-197392426.png" class="lightbox" data-gallery="quarto-lightbox-gallery-49"><img src="images/image-197392426.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p>위의 예에서 ‘%ddd%’ 처럼 문자열 처음과 끝을 %로 감쌀 경우 ’문자열 안에 ddd를 포함하고 있는 모든 문자열’을 나타낸다. 결과를 살펴보면 ddd로 시작하거나 끝나는, 혹은 문자열 가운데에 ddd가 있는 문자열이 검색된다.</p>
<p>마지막으로 후방 일치 검색을 해보도록 하겠다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>select <span class="sc">*</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>from SampleLike</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>where strcol like <span class="st">'%ddd'</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><a href="images/image-240846908.png" class="lightbox" data-gallery="quarto-lightbox-gallery-50"><img src="images/image-240846908.png" class="img-fluid"></a> ’%ddd’의 경우 전방 일치와 반대로 ddd로 끝나는 문자열을 검색한다.</p>
</section>
<section id="between-범위-검색" class="level4">
<h4 class="anchored" data-anchor-id="between-범위-검색"><code>between</code>: 범위 검색</h4>
<p><code>between</code>은 범위 검색을 수행한다. goods 테이블에서 sell_price가 100원부터 1000원까지인 상품을 선택할 때 <code>between</code> 술어를 사용하면 다음과 같이 나타낼 수 있다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>select <span class="sc">*</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>from goods</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>where sell_price between <span class="dv">100</span> and <span class="dv">1000</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-2058210045.png" class="lightbox" data-gallery="quarto-lightbox-gallery-51"><img src="images/image-2058210045.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p><code>between</code>을 사용할 경우 범위에 해당하는 100과 1000 데이터도 포함한다.</p>
</section>
<section id="is-null-is-not-null-null-데이터-선택" class="level4">
<h4 class="anchored" data-anchor-id="is-null-is-not-null-null-데이터-선택"><code>is null</code>, <code>is not null</code>: null 데이터 선택</h4>
<p>만일 null이 포함된 행을 선택하려면 어떻게 해야 할까? where 구를 <code>where buy_price = null</code> 형식으로 작성하면 될 듯 하지만 해당 쿼리를 실행하면 오류가 발생한다. 이는 null이 비교가 불가능한 특별한 표시어이기 때문이며, 이때는 <code>is null</code> 술어를 사용해야 한다. 먼저 buy_price가 null인 데이터를 선택하는 쿼리는 다음과 같다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>select <span class="sc">*</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>from goods</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>where buy_price is null;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-463040478.png" class="lightbox" data-gallery="quarto-lightbox-gallery-52"><img src="images/image-463040478.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p>buy_price가 null인 데이터만 선택된다. 반대로 null이 포함되지 않은 데이터만 선택하고 싶을 때는 <code>is not null</code> 술어를 사용한다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>select <span class="sc">*</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>from goods</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>where buy_price is not null;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-1856387102.png" class="lightbox" data-gallery="quarto-lightbox-gallery-53"><img src="images/image-1856387102.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</section>
<section id="in-복수의-값을-지정" class="level4">
<h4 class="anchored" data-anchor-id="in-복수의-값을-지정"><code>in</code>: 복수의 값을 지정</h4>
<p>만일 buy_price가 320, 500, 5000인 상품을 선택할 경우, or을 쓰면 다음과 같이 쿼리를 작성해야 한다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>select <span class="sc">*</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>from goods</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>where buy_price <span class="ot">=</span> <span class="dv">320</span> </span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>    or buy_price <span class="ot">=</span> <span class="dv">500</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>    or buy_price <span class="ot">=</span> <span class="dv">5000</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>그러나 이러한 나열식의 쿼리는 조건이 많아질수록 길어지고 효율성이 떨어진다. 이 때 사용할 수 있는 것이 <code>in</code> 술어로써 <code>in(값 1, 값 2, …)</code> 형태를 통해 간단하게 표현할 수 있다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>select <span class="sc">*</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>from goods</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>where buy_price <span class="cf">in</span> (<span class="dv">320</span>, <span class="dv">500</span>, <span class="dv">5000</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-120734180.png" class="lightbox" data-gallery="quarto-lightbox-gallery-54"><img src="images/image-120734180.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p>반대로 buy_price가 320, 500, 5000이 아닌 데이터만 선택하고 싶을 때는 <code>not in</code> 술어를 사용한다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>select <span class="sc">*</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>from goods</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>where buy_price not <span class="cf">in</span> (<span class="dv">320</span>, <span class="dv">500</span>, <span class="dv">5000</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-1954539578.png" class="lightbox" data-gallery="quarto-lightbox-gallery-55"><img src="images/image-1954539578.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</section>
</section>
<section id="case-식" class="level3">
<h3 class="anchored" data-anchor-id="case-식"><code>case</code> 식</h3>
<p>case 식은 경우에 따라 값을 구분하며, 쿼리 형식은 다음과 같다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>case when <span class="sc">&lt;</span>평가식 <span class="dv">1</span><span class="sc">&gt;</span> then <span class="sc">&lt;</span>식 <span class="dv">1</span><span class="sc">&gt;</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>    when <span class="sc">&lt;</span>평가식 <span class="dv">2</span><span class="sc">&gt;</span> then <span class="sc">&lt;</span>식 <span class="dv">2</span><span class="sc">&gt;</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>    when <span class="sc">&lt;</span>평가식 <span class="dv">3</span><span class="sc">&gt;</span> then <span class="sc">&lt;</span>식 <span class="dv">3</span><span class="sc">&gt;</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>        ⋮</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="sc">&lt;</span>식 n<span class="sc">&gt;</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>end</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>sell_price 열의 가격에 따라 고가/중가/저가로 나눠보도록 하겠다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>select goods_name, sell_price,</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>    case when sell_price <span class="sc">&gt;=</span>  <span class="dv">6000</span> then <span class="st">'고가'</span>    </span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>         when sell_price <span class="sc">&gt;=</span> <span class="dv">3000</span> and sell_price <span class="sc">&lt;</span> <span class="dv">6000</span> then <span class="st">'중가'</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>         when sell_price <span class="sc">&lt;</span> <span class="dv">3000</span> then <span class="st">'저가'</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>         <span class="cf">else</span> null</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>end as price_classify</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>from goods;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-349724111.png" class="lightbox" data-gallery="quarto-lightbox-gallery-56"><img src="images/image-349724111.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p><code>else</code> 구문은 위에서 만족하는 조건이 없을 때의 반환값으로써 생략할 수도 있지만 명시적으로 기술하는 것이 좋으며, <code>end</code>는 생략이 불가능하다. 조건에 따른 결과가 end as 뒤에 입력한 ‘price_classify’ 열에 표시된다.</p>
</section>
</section>
<section id="테이블의-집합과-결합" class="level2">
<h2 class="anchored" data-anchor-id="테이블의-집합과-결합">테이블의 집합과 결합</h2>
<p>SQL을 사용할 경우 하나의 테이블만 이용해 데이터를 다루는 일은 거의 없으며, 한번에 여러개의 테이블을 더하거나 결합하여 원하는 데이터를 얻을 수 있다. 이번에는 테이블의 각종 결합 방법에 대해 알아보도록 하겠다.</p>
<section id="테이블-결합" class="level3">
<h3 class="anchored" data-anchor-id="테이블-결합">테이블 결합</h3>
<p>앞서 살펴 본 <code>union</code> 은 행으로 테이블을 합치는 것이었다. 이번에 살펴 볼 결합(<code>join</code>)은 다른 테이블에서 열을 가지고 와 <strong>열을 늘리는</strong> 작업을 한다. 실무에서는 원하는 데이터가 여러 테이블에 분산되어 있는 경우가 많으므로, 테이블을 결합하여 사용해야 한다. <code>join</code>을 시각화하면 다음과 같다.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-2085244472.png" class="lightbox" data-gallery="quarto-lightbox-gallery-57"><img src="images/image-2085244472.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p>먼저 아래의 테이블(StoreGoods)을 만든다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>CREATE TABLE StoreGoods</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>(store_id <span class="fu">CHAR</span>(<span class="dv">4</span>) NOT <span class="cn">NULL</span>,</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a> store_name <span class="fu">VARCHAR</span>(<span class="dv">200</span>) NOT <span class="cn">NULL</span>,</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a> goods_id <span class="fu">CHAR</span>(<span class="dv">4</span>) NOT <span class="cn">NULL</span>,</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a> num INTEGER NOT <span class="cn">NULL</span>,</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a> PRIMARY <span class="fu">KEY</span> (store_id, goods_id));</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>insert into <span class="fu">StoreGoods</span> (store_id, store_name, goods_id, num) <span class="fu">values</span> (<span class="st">'000A'</span>, <span class="st">'서울'</span>,  <span class="st">'0001'</span>, <span class="dv">30</span>);</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>insert into <span class="fu">StoreGoods</span> (store_id, store_name, goods_id, num) <span class="fu">values</span> (<span class="st">'000A'</span>, <span class="st">'서울'</span>,  <span class="st">'0002'</span>, <span class="dv">50</span>);</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>insert into <span class="fu">StoreGoods</span> (store_id, store_name, goods_id, num) <span class="fu">values</span> (<span class="st">'000A'</span>, <span class="st">'서울'</span>,  <span class="st">'0003'</span>, <span class="dv">15</span>);</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>insert into <span class="fu">StoreGoods</span> (store_id, store_name, goods_id, num) <span class="fu">values</span> (<span class="st">'000B'</span>, <span class="st">'대전'</span>,  <span class="st">'0002'</span>, <span class="dv">30</span>);</span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>insert into <span class="fu">StoreGoods</span> (store_id, store_name, goods_id, num) <span class="fu">values</span> (<span class="st">'000B'</span>,<span class="st">' 대전'</span>,  <span class="st">'0003'</span>, <span class="dv">120</span>);</span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a>insert into <span class="fu">StoreGoods</span> (store_id, store_name, goods_id, num) <span class="fu">values</span> (<span class="st">'000B'</span>, <span class="st">'대전'</span>,  <span class="st">'0004'</span>, <span class="dv">20</span>);</span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>insert into <span class="fu">StoreGoods</span> (store_id, store_name, goods_id, num) <span class="fu">values</span> (<span class="st">'000B'</span>, <span class="st">'대전'</span>,  <span class="st">'0006'</span>, <span class="dv">10</span>);</span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a>insert into <span class="fu">StoreGoods</span> (store_id, store_name, goods_id, num) <span class="fu">values</span> (<span class="st">'000B'</span>, <span class="st">'대전'</span>,  <span class="st">'0007'</span>, <span class="dv">40</span>);</span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a>insert into <span class="fu">StoreGoods</span> (store_id, store_name, goods_id, num) <span class="fu">values</span> (<span class="st">'000C'</span>, <span class="st">'부산'</span>,  <span class="st">'0003'</span>, <span class="dv">20</span>);</span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a>insert into <span class="fu">StoreGoods</span> (store_id, store_name, goods_id, num) <span class="fu">values</span> (<span class="st">'000C'</span>, <span class="st">'부산'</span>,  <span class="st">'0004'</span>, <span class="dv">50</span>);</span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a>insert into <span class="fu">StoreGoods</span> (store_id, store_name, goods_id, num) <span class="fu">values</span> (<span class="st">'000C'</span>, <span class="st">'부산'</span>,  <span class="st">'0006'</span>, <span class="dv">90</span>);</span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a>insert into <span class="fu">StoreGoods</span> (store_id, store_name, goods_id, num) <span class="fu">values</span> (<span class="st">'000C'</span>, <span class="st">'부산'</span>,  <span class="st">'0007'</span>, <span class="dv">70</span>);</span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true" tabindex="-1"></a>insert into <span class="fu">StoreGoods</span> (store_id, store_name, goods_id, num) <span class="fu">values</span> (<span class="st">'000D'</span>, <span class="st">'대구'</span>,  <span class="st">'0001'</span>, <span class="dv">100</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-1563402346.png" class="lightbox" data-gallery="quarto-lightbox-gallery-58"><img src="images/image-1563402346.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p>Goods와 StoreGoods 테이블에 있는 열들을 정리하면 다음과 같다.</p>
<table class="table">
<thead>
<tr class="header">
<th></th>
<th>Goods</th>
<th>StoreGoods</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>goods_id (상품ID)</td>
<td>O</td>
<td>O</td>
</tr>
<tr class="even">
<td>goods_name (상품명)</td>
<td>O</td>
<td></td>
</tr>
<tr class="odd">
<td>goods_classify (상품분류)</td>
<td>O</td>
<td></td>
</tr>
<tr class="even">
<td>sell_price (판매단가)</td>
<td>O</td>
<td></td>
</tr>
<tr class="odd">
<td>buy_price (매입단가)</td>
<td>O</td>
<td></td>
</tr>
<tr class="even">
<td>register_date (등록일)</td>
<td>O</td>
<td></td>
</tr>
<tr class="odd">
<td>store_id (점포ID)</td>
<td></td>
<td>O</td>
</tr>
<tr class="even">
<td>store_name (점포명)</td>
<td></td>
<td>O</td>
</tr>
<tr class="odd">
<td>num (수량)</td>
<td></td>
<td>O</td>
</tr>
</tbody>
</table>
<section id="inner-join-내부-결합" class="level4">
<h4 class="anchored" data-anchor-id="inner-join-내부-결합"><code>inner join</code>: 내부 결합</h4>
<p>내부 결합(inner join)은 가장 많이 사용되는 결합 방법이다. 위의 테이블을 살펴보면 goods_id는 두 테이블에 모두 존재하며, 다른 열들은 한쪽 테이블에만 존재한다. 따라서 goods_id를 기준으로 StoreGoods 테이블에 Goods 테이블을 결합하는 방법은 다음과 같으며, 이는 마치 엑셀의 vlookup과도 비슷하다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>select store.store_id, store.store_name, store.goods_id,</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>    goods.goods_name, goods.sell_price</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>from StoreGoods as store </span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>inner join Goods as goods</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>    on store.goods_id <span class="ot">=</span> goods.goods_id;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-385211246.png" class="lightbox" data-gallery="quarto-lightbox-gallery-59"><img src="images/image-385211246.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<ol type="1">
<li><p>지금까지는 from에 하나의 테이블만 지정했지만, join 시에는 두 테이블(StoreGoods, Goods)에서 내용을 가지고 온다. 따라서 두 테이블에 store와 goods라는 별명을 붙였다. (원래 테이블명을 그대로 사용해도 되나 테이블명이 길면 가독성이 떨어지므로 일반적으로 별명을 붙인다.)</p></li>
<li><p>on 뒤에 결합 조건을 붙인다. 이는 <code>* join</code> 구문 바로 뒤에 붙이며, store의 goods_id 열과 goods 열의 goods_id 열을 이용해 두 테이블을 연결한다는 의미다.</p></li>
<li><p>select 구에서는 &lt;테이블 별명&gt;.&lt;열 이름&gt; 형식으로 기술한다. 이는 테이블이 여러개가 있으므로, 어느 테이블에서 데이터를 가지고 오는지 혼동하는 것을 방지하기 위해서이다.</p></li>
</ol>
</section>
<section id="outer-join-외부-결합" class="level4">
<h4 class="anchored" data-anchor-id="outer-join-외부-결합"><code>outer join</code> 외부 결합</h4>
<p>inner join은 두 테이블에 모두 존재하는 데이터를 합쳤지만, outer join은 한쪽 테이블에만 존재하는 데이터도 출력한다. 먼저 StoreGoods와 Goods에 존재하는 상품ID를 검색한다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>select <span class="fu">distinct</span>(goods_id) from StoreGoods;</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>select <span class="fu">distinct</span>(goods_id) from Goods;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>StoreGoods: 0001, 0002, 0003, 0004, 0006, 0007</li>
<li>Goods: 0001, 0002, 0003, 0004, 0005, 0006, 0007, 0008</li>
</ul>
<p>StoreGoods 1~4, 6~7번이, Goods 1번부터 8번까지 상품이 있다. 즉, StoreGoods 5번(압력솥)과 8번(볼펜) ID에 해당하는 물건이 없다. 이제 <code>outer join</code>을 해보도록 한다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>select store.store_id, store.store_name, goods.goods_id,</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>    goods.goods_name, goods.sell_price</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>from StoreGoods as store </span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>right outer join Goods as goods</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>    on store.goods_id <span class="ot">=</span> goods.goods_id;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-1002142944.png" class="lightbox" data-gallery="quarto-lightbox-gallery-60"><img src="images/image-1002142944.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p>goods_id가 5(압력솥)와 8(볼펜)의 경우 StoreGoods 테이블에 데이터가 존재하지 않는다. 즉, 현재 어떤 점포에서도 취급하지 않는 상품이다. <code>inner join</code>은 양쪽 테이블에 모두 존재하는 정보만을 선택하기 때문에 Goods 테이블에만 존재하는 두 상품은 결과로 출력되지 않았다. 반면 <code>outer join</code>은 한쪽 테이블에만 존재해도 누락 없이 모두 출력하며, 정보가 없는 부분은 NULL로 표시한다.</p>
<p>또한 <code>outer join</code>은 어느 쪽 테이블을 마스터로 할 것인지 정해야 한다. 즉 left 혹은 right를 지정해주어야 한다. left를 사용하면 from 구에서 왼쪽에 지정한 테이블을 마스터로 설정하며, right를 사용하면 오른쪽 테이블을 마스터로 한다. 위의 쿼리는 마스터 테이블을 right로 지정하였기에 오른쪽에 해당하는 Goods 테이블의 내용이 모두 출력되고, goods_id를 기준으로 왼쪽에 해당하는 StoreGoods 테이블의 내용이 결합되었다. 위 쿼리를 <code>left outer join</code> 으로 바꿔보도록 하자.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>select store.store_id, store.store_name, goods.goods_id,</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>    goods.goods_name, goods.sell_price</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>from StoreGoods as store </span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>left outer join Goods as goods</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>    on store.goods_id <span class="ot">=</span> goods.goods_id;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-1895788730.png" class="lightbox" data-gallery="quarto-lightbox-gallery-61"><img src="images/image-1895788730.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p>마스터 테이블인 StoreGoods에 존재하는 goods_id(1~4, 6~7)는 결합되는 테이블인 Goods에도 모두 존재하므로 이번에는 NULL이 생성되지 않는다. 어떤 테이블을 기준으로 삼아야 하는가를 미리 생각하여 <code>left outer join</code>을 할지 <code>right outer join</code>을 할지 결정해야 한다.</p>
</section>
</section>
</section>
<section id="sql-고급-처리" class="level2">
<h2 class="anchored" data-anchor-id="sql-고급-처리">SQL 고급 처리</h2>
<p>이번에는 마지막으로 순위 계산, 누적합 계산, 소계를 구하는 등 고급 집계 처리를 하는 방법인 윈도우 함수에 대해 배워보겠다.</p>
<section id="윈도우-함수" class="level3">
<h3 class="anchored" data-anchor-id="윈도우-함수">윈도우 함수</h3>
<p>윈도우 함수를 이용하면 랭킹, 순번 생성 등 일반적인 집약 함수로는 불가능한 고급처리를 할 수 있다. 윈도우 함수의 사용법은 크게 다음과 같다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&lt;</span>윈도우 함수<span class="sc">&gt;</span> <span class="fu">over</span> ([partition by <span class="sc">&lt;</span>열 리스트<span class="sc">&gt;</span>] order by <span class="sc">&lt;</span>정렬용 열 리스트<span class="sc">&gt;</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>이 중 <code>partition by</code>는 생략이 가능하다.</p>
<p>윈도우 함수로 사용할 수 있는 함수는 크게 다음과 같다.</p>
<ul>
<li>윈도우 전용 함수: <code>rank</code>, <code>dense_rank</code>, <code>row_number</code> 등</li>
<li>집약함수: <code>sum</code>, <code>avg</code>, <code>count</code>, <code>max</code>, <code>min</code> 등</li>
</ul>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>윈도우 전용 함수는 원칙적으로 select 구에만 사용할 수 있다.</p>
</div>
</div>
<section id="rank-순위를-계산" class="level4">
<h4 class="anchored" data-anchor-id="rank-순위를-계산"><code>rank</code>: 순위를 계산</h4>
<p><code>rank</code> 함수는 순위를 구하는 함수다. 예를 들어 Goods 테이블의 상품 중 상품분류(goods_classify) 별로 판매단가(sell_price)가 낮은 순서대로 순위를 구하는 방법은 다음과 같다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>select goods_name, goods_classify, sell_price,</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rank</span>() <span class="fu">over</span> (partition by goods_classify order by sell_price) as ranking</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>from Goods;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-1274297600.png" class="lightbox" data-gallery="quarto-lightbox-gallery-62"><img src="images/image-1274297600.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<ol type="1">
<li><code>partition by</code>는 순위를 정할 대상 범위를 설정하며, 어떤 조건으로 그룹을 나눈다고 생각하면 이해가 쉽다. 상품 분류마다 순위를 구하고자 하므로 goods_classify를 입력한다.</li>
<li><code>order by</code>는 윈도우 함수를 어떤 열에 어떤 순서로 적용할지 정한다. 판매단가를 오름차순으로 순위를 구하고자 하므로 sell_price를 입력하였다. 만일 내림차순으로 순위를 구하고자 할 경우 <code>desc</code> 를 입력하면 된다. (기본적으로 asc 즉 오름차순이 적용된다.)</li>
<li>순위를 구하는 윈도우 전용 함수인 <code>rank()</code>를 입력한다.</li>
</ol>
<p>이 중 <code>partition by</code>를 통해 구분된 레코드 집합을 ’윈도우’라고 하며, 이는 ’범위’를 나타낸다. 만일 <code>partition by</code>를 지정하지 않으면 전체 테이블이 윈도우가 되므로, 아래와 같이 sell_price 열 자체를 기준으로 순위가 구해진다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>select goods_name, goods_classify, sell_price,</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rank</span> () <span class="fu">over</span> (order by sell_price) as ranking</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>from Goods; </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-1786080449.png" class="lightbox" data-gallery="quarto-lightbox-gallery-63"><img src="images/image-1786080449.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p>순위를 구하는 함수는 rank 외에도 다양하게 존재하며, 그 결과가 약간씩 다르다.</p>
<ul>
<li><code>rank</code>: 같은 순위인 행이 복수개 있으면 후순위를 건너뛴다. 예) 1위가 3개인 경우: 1위, 1위, 1위, 4위, …</li>
<li><code>dense_rank</code>: 같은 순위인 행이 복수가 있어도 후순위를 건너뛰지 않는다. 예) 1위가 3개인 경우: 1위, 1위, 1위, 2위, …</li>
<li><code>row_number</code>: 순위와 상관없이 연속 번호를 부여한다. 예: 1위가 3개인 레코드인 경우: 1위, 2위, 3위, 4위, …</li>
</ul>
<p>각 함수 별 차이를 살펴보도록 하자.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>select goods_name, goods_classify, sell_price,</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rank</span>() <span class="fu">over</span> (order by sell_price) as ranking,</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dense_rank</span>() <span class="fu">over</span> (order by sell_price) as ranking,</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">row_number</span>() <span class="fu">over</span> (order by sell_price) as ranking</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>from Goods;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-191970888.png" class="lightbox" data-gallery="quarto-lightbox-gallery-64"><img src="images/image-191970888.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</section>
<section id="윈도우-함수에서-집약-함수의-사용" class="level4">
<h4 class="anchored" data-anchor-id="윈도우-함수에서-집약-함수의-사용">윈도우 함수에서 집약 함수의 사용</h4>
<p><code>sum</code>이나 <code>avg</code>와 같은 집약 함수도 윈도우 함수로 사용할 수 있다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>select goods_id, goods_name, sell_price,</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>(sell_price) <span class="fu">over</span>() as current_sum</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>from Goods;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-650811535.png" class="lightbox" data-gallery="quarto-lightbox-gallery-65"><img src="images/image-650811535.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p><code>over()</code>를 빈 칸으로 둘 경우 current_sum 열에는 모든 sell_price의 합계가 나타난다. 이번에는 누적합계를 구해보도록 하자.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>select goods_id, goods_name, sell_price,</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>(sell_price) <span class="fu">over</span>(order by goods_id) as current_sum</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>from Goods;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-1224004298.png" class="lightbox" data-gallery="quarto-lightbox-gallery-66"><img src="images/image-1224004298.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p><code>order by</code>에 열을 지정할 경우 goods_id를 기준으로 오름차순으로 정렬한 후 누적합계를 구한다. 즉 첫번째 행은 1000, 두번째 행은 1000+500=1500, 세번째 행은 1000+500+4000=5500 과 같이 누적해서 합계가 계산되며, 이는 다른 집계함수도 마찬가지이다. 이번에는 누적평균을 계산해보도록 하자.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>select goods_id, goods_name, sell_price,</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">avg</span>(sell_price) <span class="fu">over</span>(order by goods_id) as current_avg</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>from Goods;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-1232293198.png" class="lightbox" data-gallery="quarto-lightbox-gallery-67"><img src="images/image-1232293198.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p>누적합계와 동일하게 첫번째 행은 (1000)/1=1000, 두번째 행은 (1000+500)/2=750, 세번째 행은 (1000+500+4000)/3=1833.33과 같이 누적해가며 평균을 계산한다.</p>
<p><code>partition by</code>를 추가하면 윈도우 별로 집계도 가능하다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>select goods_id, goods_classify, goods_name, sell_price,</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>(sell_price) <span class="fu">over</span>(partition by goods_classify order by goods_id) as current_sum</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>from Goods;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><a href="images/image-582586694.png" class="lightbox" data-gallery="quarto-lightbox-gallery-68"><img src="images/image-582586694.png" class="img-fluid"></a> partition by에 해당하는 goods_classify 별로(사무용품, 의류, 주방용품) 누적합계가 계산된다.</p>
</section>
<section id="이동평균-계산하기" class="level4">
<h4 class="anchored" data-anchor-id="이동평균-계산하기">이동평균 계산하기</h4>
<p>윈도우 함수에서는 그 범위를 정해 ’프레임’을 만들 수도 있다. 이는 <code>over</code> 내의 <code>order by</code> 구문 뒤에 범위 지정 키워드를 사용하면 된다. 예를 들어 모든 열에 대한 누적평균이 아닌 최근 3개 데이터만 이용해 평균을 구하는 이동평균을 계산하는 쿼리는 다음과 같다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>select goods_id, goods_classify, goods_name, sell_price,</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">avg</span>(sell_price) <span class="fu">over</span>(order by goods_id rows <span class="dv">2</span> preceding) as moving_avg</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>from Goods;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-538352791.png" class="lightbox" data-gallery="quarto-lightbox-gallery-69"><img src="images/image-538352791.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p><code>rows n proceding</code>을 입력할 경우 앞의 n 행까지만 프레임을 만들어 계산한다. 위 예제에서는 n=2를 입력했으므로 현재 행과 앞의 두개 행, 즉 3개 행으로만 이동평균을 계산한다. 결과를 살펴보면 1행과 2행은 앞의 두개 행에 해당하는 데이터가 없으므로 존재하는 데이터들로 평균이 계산된다. 3행은 1~3행을 이용해 평균이 계산되며 4행은 2~4행, 5행은 3~5행 등 프레임이 움직이며 이동평균이 계산된다.</p>
<p>앞의 행이 아닌 뒤의 행을 이용해 계산하고 싶을 경우 <code>preceding</code> 대신 <code>following</code>을 입력한다. 현재 행과 뒤의 두개 행으로 이동평균을 계산하는 법은 다음과 같다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>select goods_id, goods_classify, goods_name, sell_price,</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">avg</span>(sell_price) <span class="fu">over</span>(order by goods_id rows between current row and <span class="dv">2</span> following) as moving_avg</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>from Goods;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><a href="images/image-1956784107.png" class="lightbox" data-gallery="quarto-lightbox-gallery-70"><img src="images/image-1956784107.png" class="img-fluid"></a> <code>current row and 2 following</code>는 현재 행과 뒤의 두개 행을 의미하며, 앞서 살펴 본 <code>preceding</code>과 반대로 뒤에서 부터 이동평균의 계산된다. <code>preceding</code>과 <code>following</code>을 동시에 사용하는 것도 가능하다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>select goods_id, goods_classify, goods_name, sell_price,</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">avg</span>(sell_price) <span class="fu">over</span>(order by goods_id</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>    rows between <span class="dv">1</span> preceding and <span class="dv">1</span> following)</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>    as moving_avg</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>from goods;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/image-606971104.png" class="lightbox" data-gallery="quarto-lightbox-gallery-71"><img src="images/image-606971104.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p><code>rows between n preceding and m following</code>을 입력하면 앞의 n행과 뒤의 m행 까지를 프레임으로 지정한다. 위의 예에서는 앞의 1개 행과 뒤의 1개 행, 총 3개 행을 이용해 이동평균이 계산된다.</p>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<script>var lightboxQuarto = GLightbox({"selector":".lightbox","loop":true,"descPosition":"bottom","openEffect":"zoom","closeEffect":"zoom"});</script>



</body></html>